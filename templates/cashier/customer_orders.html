{% extends 'base.html' %} {% load static %} 

{% block topbar %}
<h4>View Orders</h4>
{% endblock topbar %} 

{% block topbar-button %}
<a href="{% url 'cashier-dashboard' %}"><button>Back to Dashboard</button></a>
{% endblock topbar-button %} 

{% block content %}
<main class="customer-orders my-5 px-5">
    <section class="customer-order__filter">
        <form action="" method="GET">
            <h4 class="mb-4">Filter Orders</h4>
            {{order_filter.form}}
            <button class="bg-darkbrown" type="submit">Search</button>
        </form>
    </section>
    <hr class="my-4">
    <section class="customer-orders__table">
        <h4>Customer Orders</h4>
        <table class="mt-4">
            <thead>
                <tr>
                    <th>Order ID</th>
                    <th>Order Date & Time</th>
                    <th>Receive Date & Time</th>
                    <th>Name</th>
                    <th>Address</th>
                    <th>Method</th>
                    <th>Amount</th>
                    <th>Status</th>
                    <th>Order</th>
                    <th>Edit Status</th>
                </tr>
            </thead>
            <tbody>
                
                {% for order in orders_list %}
                <tr>
                    <td>{{order.id}}</td>
                    <td>{{order.order_date}}</td>
                    <td>{{order.receive_date}} <br> {{order.receive_time}}</th>
                    <td>{{order.customer.name}}</td>
                    <td>{{order.address}}</td>
                    <td>{{order.payment_method}}</td>
                    <td>&#8369; {{order.get_cart_total}}, <br> <strong>Delivery: &#8369; {{order.delivery_fee}}</strong></td>
                    <td>{{order.order_status}}</td>
                    <td><a href=""><button class="view-order bg-darkbrown" data-product={{order.id}}>View Order</button></a></td>
                    <td><a href=""><button class="bg-sienna">Edit Status</button></a></td>
                </tr> 
                <div class="modal modal-{{order.id}}">
                    <!-- Modal content -->
                    <div class="modal-content w-25">
                        <span class="close">&times;</span>
                        <h5>All Ordered Items</h5>
                        <hr class="mt-3">
                        {% for ordered_item in ordered_items %}
                            {% if ordered_item.order.id == order.id %}
                                <p class="mb-1">x{{ordered_item.quantity}} - <strong>{{ordered_item.item.name}}</strong></p>
                            {% endif %}
                        {% endfor %}    
                    </div>
                </div>
                {% endfor %}
                    
                
            </tbody>
        </table>
    </section>
     <section class="pagination-section mt-5 text-center">
        {% if orders_list.has_other_pages %}
        <ul class="pagination justify-content-end">

          <!-- PREVIOUS -->
          {% if orders_list.has_previous %}
          <li class="page-item">
            <a href="?{{ get_copy.urlencode }}&page={{orders_list.previous_page_number}}" class="page-link">&laquo;</a>
          </li>
          {% else %}
            <li class="page-item disabled">
              <a class="page-link">&laquo;</a>
            </li>
          {% endif %}
          
          <!-- NUMBERS -->
          {% for i in orders_list.paginator.page_range %}
            {% if orders_list.number == i %}
              <li class="page-item active">
                <a class="page-link">{{i}}</a>
              </li>
            {% else %}
              <li class="page-item">
                <a href="?{{ get_copy.urlencode }}&page={{i}}" class="page-link">{{i}}</a>
              </li>
            {% endif %}
          {% endfor %}

          <!-- NEXT -->
          {% if orders_list.has_next %}
          <li class="page-item">
              
            <a href="?{{ get_copy.urlencode }}&page={{orders_list.next_page_number}}" class="page-link">&raquo;</a>
          </li>
          {% else %}
            <li class="page-item disabled">
              <a class="page-link">&raquo;</a>
            </li>
          {% endif %}

            
        </ul>
        {% endif %}
    </section>
</main>
<script>
    const viewButton = document.querySelectorAll('.view-order');
    const modals = document.querySelectorAll('.modal');
    const closeButtons = document.querySelectorAll('.close');


    for (let button of viewButton) {
        button.addEventListener('click', (e) => {
            e.preventDefault()
            let order = e.target.dataset.product;
            const currentModal = document.querySelector('.modal-' + order)
            currentModal.style.display = "block";
        })
    }

        // When the user clicks anywhere outside of the modal, close it
    window.addEventListener('click', (e) => {
        for (let modal of modals) {
            if (e.target == modal) {
                modal.style.display = 'none';
            }
        }
    });

    for (let button of closeButtons) {
        button.addEventListener('click', (e) => {
            button.parentElement.parentElement.style.display = "none"
        });
    }
    
</script>
{% endblock content %}
